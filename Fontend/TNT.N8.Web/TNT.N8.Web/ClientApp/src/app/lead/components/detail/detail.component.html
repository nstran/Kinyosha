<!-- Loading... -->
<div class="loading-indicator" *ngIf="loading">
  <p-progressSpinner [style]="{width: '50px', height: '50px'}" strokeWidth="8" fill="#EEEEEE" animationDuration=".5s">
  </p-progressSpinner>
</div>
<!-- Message Response... -->
<p-toast position="bottom-right"></p-toast>
<!-- Confirm... -->
<p-confirmDialog header="Xác nhận" icon="pi pi-exclamation-triangle" acceptLabel="Chấp nhận" rejectLabel="Không">
</p-confirmDialog>

<div class="edit-lead">
  <div class="row no-margin" id="parent">
    <div class="col-md-12 header" style="padding: 6px;" [ngClass]="{'fixed': fixed}" [ngStyle]="{'width':withFiexd}">
      <div class="row">
        <div class="col-md-4 no-padding">
          <div class="row no-margin">
            <div class="col-md-2 col-sm-1 col-xs-3 col-18">
              <div class="header-box-icon">
                <img src="/assets/icons/components/detail_lead.svg" class="header-icon">
              </div>
            </div>
            <div class="col-md-10 col-sm-10 col-xs-9 no-padding">
              <div>
                <span class="customer-name">Chi tiết cơ hội</span>
              </div>
              <div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-8">
          <div class="row">
            <div class="col-md-12" style="display: flex; justify-content: flex-end; margin-top: 5px;">
              <button type="button" (click)="backToList()" class="btn-remove">
                <span class="btn-remove-text">Quay lại</span>
              </button>

              <button *ngIf="isShowButtonCancel" type="button" (click)="setViewMode('CANC')" class="btn-remove">
                <span class="btn-remove-text">Hủy</span>
              </button>

              <button *ngIf="isShowButtonDelete && actionDelete" type="button" class="btn-remove" (click)="deleteLead()">
                <span class="btn-remove-text">Xóa</span>
              </button>

              <button *ngIf="isShowButtonConfirm" type="button" (click)="setViewMode('APPR')" class="btn-remove">
                <span class="btn-remove-text">Xác nhận</span>
              </button>

              <button type="button" (click)="cloneLead()" class="btn-remove">
                <span class="btn-remove-text">Nhân bản</span>
              </button>

              <button *ngIf="isShowButtonDvn" type="button" (click)="setViewMode('DRAFT')" class="btn-remove">
                <span class="btn-remove-text">Đặt về nháp</span>
              </button>

              <button *ngIf="isShowButtonCreateQuote" type="button" (click)="createQuote()" class="btn-remove">
                <span class="btn-remove-text">Tạo báo giá</span>
              </button>

              <button *ngIf="isShowButtonCreateHst" type="button" (click)="createSaleBidding()" class="btn-remove">
                <span class="btn-remove-text">Tạo hồ sơ thầu</span>
              </button>

              <button *ngIf="isShowButtonCreateEdit && isModeView" type="button" (click)="toModeEdit()" class="btn-remove">
                <span class="btn-remove-text">Sửa</span>
              </button>

              <button *ngIf="!isModeView" (click)="confirmEditLead()" type="button" class="btn-save">
                <span class="btn-save-text">Lưu</span>
              </button>

              <button *ngIf="!isModeView" type="button" (click)="toModeView()" class="btn-remove">
                <span class="btn-remove-text">Hủy sửa</span>
              </button>
              <!-- <div *ngIf="viewModeCode == 'DRAFT' ">
                <button type="button" (click)="setViewMode('CANC')" class="btn-remove">
                  <span class="btn-remove-text">Hủy</span>
                </button>
                <button type="button" class="btn-remove" *ngIf="actionDelete" (click)="deleteLead()">
                  <span class="btn-remove-text">Xóa</span>
                </button>
                <button type="button" *ngIf="isManager" (click)="setViewMode('APPR')" class="btn-remove">
                  <span class="btn-remove-text">Xác nhận</span>
                </button>
                <button type="button" (click)="cloneLead()" class="btn-remove">
                  <span class="btn-remove-text">Nhân bản</span>
                </button>
                <button (click)="confirmEditLead()" type="button" class="btn-save">
                  <span class="btn-save-text">Lưu</span>
                </button>
              </div>
              <div *ngIf="viewModeCode == 'APPR' ">
                <button type="button" (click)="setViewMode('CANC')" class="btn-remove">
                  <span class="btn-remove-text">Hủy</span>
                </button>
                <button type="button" (click)="createQuote()" *ngIf="isCreateQuoteButton" class="btn-remove">
                  <span class="btn-remove-text">Tạo báo giá</span>
                </button>
                <button type="button"
                  *ngIf="canCreateSaleBidding && editLeadForm.get('Pic').value && isCreateSaleBiddingButton"
                  (click)="createSaleBidding()" class="btn-remove">
                  <span class="btn-remove-text">Tạo hồ sơ thầu</span>
                </button>
                <button type="button" (click)="cloneLead()" class="btn-remove">
                  <span class="btn-remove-text">Nhân bản</span>
                </button>
                <button *ngIf="actionEdit" (click)="confirmEditLead()" type="button" class="btn-save">
                  <span class="btn-save-text">Lưu</span>
                </button>
              </div>

              <div *ngIf="viewModeCode == 'CANC' ">
                <button type="button" (click)="cloneLead()" class="btn-remove">
                  <span class="btn-remove-text">Nhân bản</span>
                </button>
                <button type="button" (click)="setViewMode('DRAFT')" class="btn-remove">
                  <span class="btn-remove-text">Đặt về nháp</span>
                </button>
              </div>

              <div *ngIf="viewModeCode == 'CLOSE' ">
                <button type="button" (click)="cloneLead()" class="btn-remove">
                  <span class="btn-remove-text">Nhân bản</span>
                </button>
              </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <form [formGroup]="editLeadForm">
    <div class="row no-margin" style="padding-top: 10px;padding-bottom: 10px;">
      <div class="col-md-12 customer-infor">
        <div class="row edit-visit-card">
          <p-accordion expandIcon="pi pi-fw pi-chevron-circle-right" collapseIcon="pi pi-fw pi-chevron-circle-down">
            <p-accordionTab header="Thông tin chung" [selected]="true">
              <div class="row">
                <div class="col-md-12 p-0">
                  <div class="col-md-12 text-right" style="padding-bottom: 10px;">
                    <button pButton label="Chuyển trạng thái" (click)="changeStatusSupport()"></button>
                  </div>
                  <div class="col-md-12">
                    <ul class="nav nav-tabs slds-path__nav">
                      <ng-container *ngFor="let item of listFormatStatusSupport">
                        <li *ngIf="item.categoryCode == 'TEMP'" data-toggle="tab" class="slds-path__item" [ngClass]="[item.isActive ? 'active': '',
                              item.isComplete ? 'slds-is-complete' : 'slds-is-incomplete',
                              item.isCurrent ? 'slds-is-current' : '']" (click)="changeActive(item)">
                          <p-dropdown [options]="item.children" optionLabel="categoryName"
                            [(ngModel)]="selectedTempStatusSupport" [ngModelOptions]="{standalone: true}"
                            [autoDisplayFirst]="false" [style]="{'width': '100%'}">
                          </p-dropdown>
                        </li>
                        <li *ngIf="item.categoryCode != 'TEMP'" data-toggle="tab" class="slds-path__item" [ngClass]="[item.isActive ? 'active': '',
                            item.isComplete ? 'slds-is-complete' : 'slds-is-incomplete',
                            item.isCurrent ? 'slds-is-current' : '']" (click)="changeActive(item)">
                          <a class="tabHeader slds-path__link" href="#" pTooltip="{{item.categoryName}}"
                            tooltipPosition="bottom" tooltipStyleClass="custom-tooltip">
                            <span class="complete slds-path__stage">
                              <i class="fa fa-check" aria-hidden="true"></i>
                            </span>
                            <span class="slds-path__title">{{item.categoryName}}</span>
                          </a>
                        </li>
                      </ng-container>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="row buffer-bottom">
                <div class="col-md-2">
                  <p-radioButton [disabled]="isModeView || !isNotReference" name="group1" value="cus" label="Khách hàng" [(ngModel)]="selectedObjectType"
                    (keydown.enter)="$event.preventDefault()" [ngModelOptions]="{standalone: true}"
                    (onClick)="changeObjectType('cus', true)">
                  </p-radioButton>
                </div>
                <div class="col-md-4" style="margin-top: 5px;">
                  <p-radioButton [disabled]="isModeView || !isNotReference" name="group1" value="lea" label="Khách hàng tiềm năng" [(ngModel)]="selectedObjectType"
                    (keydown.enter)="$event.preventDefault()" [ngModelOptions]="{standalone: true}"
                    (onClick)="changeObjectType('lea', true)">
                  </p-radioButton>
                </div>
              </div>

              <div *ngIf="!isModeView">
                <!-- HÀNG I -->
                <div class="row buffer-bottom">
                  <div class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-12 buffer-bottom-label">
                        <span>Tên cơ hội tiềm năng</span><span class="required">*</span>
                      </div>
                      <div class="col-md-12">
                        <input formControlName="LeadName" maxlength="100"
                          [ngClass]="(editLeadForm.get('LeadName').invalid && (editLeadForm.get('LeadName').dirty || editLeadForm.get('LeadName').touched)) ? 'error-border' : ''"
                          type="text" class="w100" pInputText placeholder="" (keydown.enter)="$event.preventDefault()"
                          maxlength="250" />
                      </div>
                      <div class="col-md-12"
                        [hidden]="editLeadForm.get('LeadName').valid || editLeadForm.get('LeadName').untouched">
                        <span *ngIf="editLeadForm.get('LeadName').hasError('required')" class="error-message-span">
                          Nhập tên cơ hội</span>
                        <span *ngIf="editLeadForm.get('LeadName').hasError('forbiddenSpaceText')"
                          class="error-message-span">
                          Tên cơ hội không được để trắng</span>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-12 buffer-bottom-label">
                        <span>Loại khách hàng</span>
                      </div>
                      <div class="col-md-12">
                        <p-dropdown formControlName="LeadType" (onChange)="changeTypeLead(editLeadForm.get('LeadType'))"
                          [styleClass]="(editLeadForm.get('LeadType').invalid && (editLeadForm.get('LeadType').dirty || editLeadForm.get('LeadType').touched)) ? 'error-border' : ''"
                          [options]="listLeadType" optionLabel="name" placeholder="Chọn loại khách hàng"
                          [showClear]="true" [style]="{'width': '100%'}" (keydown.enter)="$event.preventDefault()">
                        </p-dropdown>
                      </div>
                      <div class="col-md-12">
                        <span [hidden]="editLeadForm.get('LeadType').valid || editLeadForm.get('LeadType').untouched"
                          *ngIf="editLeadForm.get('LeadType').hasError('required')" class="error-message-span">
                          Chọn loại khách hàng</span>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-12 buffer-bottom-label">
                        <div class="row">
                          <div class="col-md-6">
                            <span>Khách hàng</span>
                          </div>
                          <div *ngIf="editLeadForm.get('RefCustomer').value != null" class="col-md-6"
                            style="text-align: right;color: blue;" pTooltip="xem chi khách hàng">
                            <i (click)="goToCustomerDetail($event)" style="cursor: pointer;"
                              class="pi pi-arrow-right"></i>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-12">
                        <p-dropdown formControlName="RefCustomer"
                          [styleClass]="(editLeadForm.get('RefCustomer').invalid && (editLeadForm.get('RefCustomer').dirty || editLeadForm.get('RefCustomer').touched)) ? 'error-border' : ''"
                          [options]="listCurrentCustomer" optionLabel="customerName" placeholder="Chọn khách hàng"
                          [filter]="true" [resetFilterOnHide]="true" [virtualScroll]="true" itemSize="30"
                          [showClear]="true" (onChange)="changeCustomer($event)" [style]="{'width': '100%'}"
                          (keydown.enter)="$event.preventDefault()">
                        </p-dropdown>
                      </div>

                      <div class="col-md-12">
                        <span
                          [hidden]="editLeadForm.get('RefCustomer').valid || editLeadForm.get('RefCustomer').untouched"
                          *ngIf="editLeadForm.get('RefCustomer').hasError('required')" class="error-message-span">
                          Chọn khách hàng</span>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Số điện thoại</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="Phone" maxlength="32"
                              (change)="checkDuplicateCustomer('phone', editLeadForm.get('Phone'))"
                              [ngClass]="(editLeadForm.get('Phone').invalid && (editLeadForm.get('Phone').dirty || editLeadForm.get('Phone').touched)) ? 'error-border' : ''"
                              type="text" class="w100" pInputText placeholder=""
                              (keydown.enter)="$event.preventDefault()" />
                          </div>
                          <div class="col-md-12"
                            [hidden]="editLeadForm.get('Phone').valid || editLeadForm.get('Phone').untouched">
                            <span *ngIf="editLeadForm.get('Phone').hasError('required')" class="error-message-span">
                              Nhập số điện thoại</span>
                            <span *ngIf="editLeadForm.get('Phone').hasError('pattern')" class="error-message-span">
                              Sai định dạng số điện thoại</span>
                            <span *ngIf="editLeadForm.get('Phone').hasError('duplicatePhoneLead')"
                              class="error-message-span">
                              Số điện thoại đã được đăng ký</span>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Email</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="Email" maxlength="100"
                              (change)="checkDuplicateCustomer('email', editLeadForm.get('Email'))"
                              [ngClass]="(editLeadForm.get('Email').invalid && (editLeadForm.get('Email').dirty || editLeadForm.get('Email').touched)) ? 'error-border' : ''"
                              type="text" class="w100" pInputText placeholder=""
                              (keydown.enter)="$event.preventDefault()" />
                          </div>
                          <div class="col-md-12"
                            [hidden]="editLeadForm.get('Email').valid || editLeadForm.get('Email').untouched">
                            <span *ngIf="editLeadForm.get('Email').hasError('pattern')" class="error-message-span">
                              Sai định dạng Email</span>
                            <span *ngIf="editLeadForm.get('Email').hasError('duplicateEmailLead')"
                              class="error-message-span">
                              Email đã được đăng ký</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- HÀNG II -->
                <div class="row buffer-bottom">
                  <div class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-12 buffer-bottom-label">
                        <span>Địa chỉ cụ thể</span><span class="required">*</span>
                      </div>
                      <div class="col-md-12">
                        <input formControlName="DetailAddress" type="text" class="w100" pInputText maxlength="250"
                          [ngClass]="(editLeadForm.get('DetailAddress').invalid && (editLeadForm.get('DetailAddress').dirty || editLeadForm.get('DetailAddress').touched)) ? 'error-border' : ''"
                          placeholder="Số nhà, số đường..." (keydown.enter)="$event.preventDefault()" />
                      </div>
                      <div class="col-md-12">
                        <span
                          [hidden]="editLeadForm.get('DetailAddress').valid || editLeadForm.get('DetailAddress').untouched"
                          *ngIf="editLeadForm.get('DetailAddress').hasError('required')" class="error-message-span">
                          Nhập địa chỉ cụ thể</span>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Người phụ trách</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="Pic"
                              [styleClass]="(editLeadForm.get('Pic').invalid && (editLeadForm.get('Pic').dirty || editLeadForm.get('Pic').touched)) ? 'error-border' : ''"
                              [options]="listPersonalInChangeCus" optionLabel="employeeCodeName"
                              placeholder="Chọn người phụ trách" [filter]="true" [showClear]="true"
                              [resetFilterOnHide]="true" [style]="{'width': '100%'}"
                              (keydown.enter)="$event.preventDefault()">
                            </p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span [hidden]="editLeadForm.get('Pic').valid || editLeadForm.get('Pic').untouched"
                              *ngIf="editLeadForm.get('Pic').hasError('required')" class="error-message-span">
                              Chọn người phụ trách</span>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Nguồn tiềm năng</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="InvestFund"
                              [styleClass]="(editLeadForm.get('InvestFund').invalid && (editLeadForm.get('InvestFund').dirty || editLeadForm.get('InvestFund').touched)) ? 'error-border' : ''"
                              [options]="listInvestFund" optionLabel="categoryName" placeholder="Chọn nguồn tiềm năng"
                              [showClear]="true" [style]="{'width': '100%'}" (keydown.enter)="$event.preventDefault()">
                            </p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span
                              [hidden]="editLeadForm.get('InvestFund').valid || editLeadForm.get('InvestFund').untouched"
                              *ngIf="editLeadForm.get('InvestFund').hasError('required')" class="error-message-span">
                              Chọn nguồn tiềm năng</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Nhu cầu SP, DV</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <p-multiSelect formControlName="Interested" [options]="listInterestedGroup"
                              optionLabel="categoryName" [virtualScroll]="true" itemSize="30"
                              defaultLabel="Chọn nhu cầu sản phẩm, dịch vụ"
                              [styleClass]="(editLeadForm.get('Interested').invalid && (editLeadForm.get('Interested').dirty || editLeadForm.get('Interested').touched)) ? 'error-border' : ''"
                              [style]="{'width': '100%'}" [resetFilterOnHide]="true"
                              selectedItemsLabel="{0} nhu cầu sản phẩm, dịch vụ" [filter]="true"
                              (keydown.enter)="$event.preventDefault()">
                            </p-multiSelect>
                          </div>
                          <div class="col-md-12">
                            <span
                              [hidden]="editLeadForm.get('Interested').valid || editLeadForm.get('Interested').untouched"
                              *ngIf="editLeadForm.get('Interested').hasError('required')" class="error-message-span">
                              Chọn nhu cầu sản phẩm, dịch vụ</span>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="row buffer-bottom">
                          <div class="col-md-12">
                            <div class="row">
                              <div class="col-md-12 buffer-bottom-label">
                                <span>Loại hình DN</span>
                              </div>
                              <div class="col-md-12">
                                <p-dropdown formControlName="BusinessType" [options]="listBusinessType"
                                  optionLabel="categoryName" [virtualScroll]="true" itemSize="30"
                                  placeholder="Chọn loại hình doanh nghiệp" [filter]="true" [showClear]="true"
                                  [resetFilterOnHide]="true" [style]="{'width': '100%'}"
                                  (keydown.enter)="$event.preventDefault()"></p-dropdown>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Xác suất thắng</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="Probability"
                              [styleClass]="(editLeadForm.get('Probability').invalid && (editLeadForm.get('Probability').dirty || editLeadForm.get('Probability').touched)) ? 'error-border' : ''"
                              [options]="listProbability" optionLabel="categoryName" placeholder="Chọn xác suất thắng"
                              [showClear]="true" [style]="{'width': '100%'}" (keydown.enter)="$event.preventDefault()">
                            </p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span
                              [hidden]="editLeadForm.get('Probability').valid || editLeadForm.get('Probability').untouched"
                              *ngIf="editLeadForm.get('Probability').hasError('required')" class="error-message-span">
                              Chọn xác suất thắng</span>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Khu vực</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="Area" [options]="listArea" optionLabel="geographicalAreaName"
                              [virtualScroll]="true" itemSize="30" placeholder="Chọn khu vực" [filter]="true"
                              [showClear]="true" [resetFilterOnHide]="true" [style]="{'width': '100%'}"
                              (keydown.enter)="$event.preventDefault()"></p-dropdown>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- HÀNG III -->
                <div class="row buffer-bottom">
                  <div class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Nhóm khách hàng</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="Group"
                              [styleClass]="(editLeadForm.get('Group').invalid && (editLeadForm.get('Group').dirty || editLeadForm.get('Group').touched)) ? 'error-border' : ''"
                              [options]="listLeadGroup" optionLabel="categoryName" placeholder="Chọn nhóm khách hàng"
                              [showClear]="true" [style]="{'width': '100%'}" (keydown.enter)="$event.preventDefault()">
                            </p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span [hidden]="editLeadForm.get('Group').valid || editLeadForm.get('Group').untouched"
                              *ngIf="editLeadForm.get('Group').hasError('required')" class="error-message-span">
                              Chọn nhóm khách hàng</span>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Trạng thái</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <strong>{{viewModel.trangThai}}</strong>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div *ngIf="appName == 'VNS'" class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Giá trị mong đợi</span>
                          </div>
                          <div class="col-md-12">
                            <input type="text" class="number-input" formControlName="ExpectedSale"
                              [cleave]="{numeral: true, numeralPositiveOnly: true}"
                              (keydown.enter)="$event.preventDefault()"
                              (change)="calForecastSales()">
                          </div>
                        </div>
                      </div>
  
                      <div class="col-md-6">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Xác suất (%)</span>
                          </div>
                          <div class="col-md-12">
                            <input type="text" class="number-input" formControlName="Percent"
                              [cleave]="{numeral: true, numeralPositiveOnly: true, numeralDecimalScale: 0}"
                              (keydown.enter)="$event.preventDefault()"
                              (change)="calForecastSales()">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
  
                  <div *ngIf="appName == 'VNS'" class="col-md-6">
                    <div class="row buffer-bottom">
                      <div class="col-md-3">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Doanh số dự báo</span>
                          </div>
                          <div class="col-md-12">
                            <input type="text" class="number-input" formControlName="ForecastSales"
                              [cleave]="{numeral: true, numeralPositiveOnly: true}"
                              (keydown.enter)="$event.preventDefault()">
                          </div>
                        </div>
                      </div>
                      <div class="col-md-9">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Chi tiết yêu cầu</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="DetailInterested" type="text" class="w100" pInputText placeholder=""
                              (keydown.enter)="$event.preventDefault()" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div *ngIf="appName != 'VNS'" class="col-md-3">
                    <div class="row buffer-bottom">
                      <div class="col-md-12">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Doanh thu mong đợi</span>
                          </div>
                          <div class="col-md-12">
                            <input type="text" class="number-input" formControlName="ExpectedSale"
                              [cleave]="{numeral: true, numeralPositiveOnly: true}"
                              (keydown.enter)="$event.preventDefault()">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div *ngIf="appName != 'VNS'" class="col-md-6">
                    <div class="row buffer-bottom">
                      <div class="col-md-3">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Mức độ tiềm năng</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="Potential"
                              [styleClass]="(editLeadForm.get('Potential').invalid && (editLeadForm.get('Potential').dirty || editLeadForm.get('Potential').touched)) ? 'error-border' : ''"
                              [options]="listPotential" optionLabel="categoryName" placeholder="Chọn mức độ tiềm năng"
                              [showClear]="true" [style]="{'width': '100%'}" (keydown.enter)="$event.preventDefault()">
                            </p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span
                              [hidden]="editLeadForm.get('Potential').valid || editLeadForm.get('Potential').untouched"
                              *ngIf="editLeadForm.get('Potential').hasError('required')" class="error-message-span">
                              Chọn mức độ tiềm năng</span>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-9">
                        <div class="row">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Chi tiết yêu cầu</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="DetailInterested" type="text" class="w100" pInputText placeholder=""
                              (keydown.enter)="$event.preventDefault()" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="isModeView">
                <div class="row buffer-bottom">
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Tên cơ hội tiềm năng
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.tenCoHoi}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.tenCoHoi)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Loại khách hàng
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.loaiKhachHang}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.loaiKhachHang)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Khách hàng
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.tenKhachHang}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.tenKhachHang)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row buffer-bottom">
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Số điện thoại
                      </div>
                      <div class="col-md-6">
                        <strong>
                          {{viewModel.phone}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Email
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.email}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.email)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Địa chỉ cụ thể
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.diaChi}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.diaChi)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row buffer-bottom">
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Người phụ trách
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.nguoiPhuTrach}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.nguoiPhuTrach)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Nguồn tiềm năng
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.nguonTiemNang}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.nguonTiemNang)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Nhu cầu sản phẩm, dịch vụ
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.nhuCauSp}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.nhuCauSp)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row buffer-bottom">
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Loại hình doanh nghiệp
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.loaiHinhDn}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.loaiHinhDn)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Xác suất thắng
                      </div>
                      <div class="col-md-6">
                        <strong>
                          {{viewModel.xacSuatThang}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Khu vực
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.khuVuc}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.khuVuc)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row buffer-bottom">
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Nhóm khách hàng
                      </div>
                      <div class="col-md-6" pTooltip="{{viewModel.nhomKhachHang}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.nhomKhachHang)}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Trạng thái
                      </div>
                      <div class="col-md-6">
                        <strong>
                          {{viewModel.trangThai}}
                        </strong>
                       </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        {{appName == 'VNS' ? 'Giá trị mong đợi' : 'Doanh thu mong đợi'}}
                      </div>
                      <div class="col-md-6">
                        <strong>
                          {{viewModel.giaTriMongDoi | number}}
                        </strong>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row buffer-bottom">
                  <div *ngIf="appName == 'VNS'" class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Xác suất (%)
                      </div>
                      <div class="col-md-6">
                        <strong>
                          {{viewModel.xacSuat | number}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="appName == 'VNS'" class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Doanh số dự báo
                      </div>
                      <div class="col-md-6">
                        <strong>
                          {{viewModel.doanhSoDuBao | number}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="appName != 'VNS'" class="col-md-4">
                    <div class="row">
                      <div class="col-md-6">
                        Mức độ tiềm năng
                      </div>
                      <div class="col-md-6">
                        <strong>
                          {{viewModel.mucDoTiemNang}}
                        </strong>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-8">
                    <div class="row">
                      <div class="col-md-3">
                        Chi tiết yêu cầu
                      </div>
                      <div class="col-md-9" pTooltip="{{viewModel.chiTietYeuCau}}" tooltipPosition="left">
                        <strong>
                          {{formaterStr(viewModel.chiTietYeuCau)}}
                        </strong> 
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </p-accordionTab>
          </p-accordion>
        </div>
      </div>
    </div>

    <div class="row no-margin" style="padding-top: 10px; padding-bottom: 10px;" #list>
      <div class="col-md-12 detail-lead">
        <div class="row">
          <p-accordion expandIcon="pi pi-fw pi-chevron-circle-right" collapseIcon="pi pi-fw pi-chevron-circle-down">
            <p-accordionTab header="Chi tiết" [selected]="true">
              <p-tabView>
                <p-tabPanel header="Liên hệ">
                  <div class="row">
                    <div *ngIf="!isModeView" class="col-md-12"
                      style="margin-bottom: 5px; display: flex; justify-content: flex-end;">
                      <span (click)="addLeadContact()">
                        <span>
                          <img src="/assets/icons/components/ios-add-circle-outline.svg" class="ios-add-circle-outline">
                        </span>
                        <span class="add-product-text">
                          Tạo liên hệ
                        </span>
                      </span>
                    </div>
                    <div class="col-md-12 mt-5">
                      <p-table [value]="listContact" [columns]="selectedColumnsContact" [scrollable]="true"
                        [resizableColumns]="true" selectionMode="single" (onRowSelect)="editContact($event.data)"
                        [style]="{width:'100%'}" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10,50,100]"
                        [responsive]="true" class="table-border">
                        <ng-template pTemplate="caption">
                          <div style="text-align:left">
                            <p-multiSelect [options]="colsContacts" colsContacts [(ngModel)]="selectedColumnsContact"
                              [ngModelOptions]="{standalone: true}" optionLabel="header"
                              selectedItemsLabel="{0} cột được chọn" [style]="{minWidth: '200px'}"
                              defaultLabel="Chọn cột">
                            </p-multiSelect>
                          </div>
                        </ng-template>
                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col *ngFor="let col of columns" style="width: 150px;">
                          </colgroup>
                        </ng-template>
                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th *ngFor="let col of columns" pResizableColumn
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}">
                              {{col.header}}
                            </th>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-rowData let-columns="columns">
                          <tr [pSelectableRow]="rowData">
                            <td *ngFor="let col of columns" class="ui-resizable-column"
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}" [ngSwitch]="col.field">
                              <span class="ui-column-title">{{col.header}}</span>
                              <span *ngSwitchCase="'dateOfBirth'">
                                {{rowData[col.field] | date:'dd/MM/yyyy'}}
                              </span>
                              <span *ngSwitchCase="'Delete'">
                                <button *ngIf="actionDelete && !isModeView" pButton icon="pi pi-trash"
                                  (click)="deleteContact(rowData)" class="ui-button-danger"></button>
                              </span>
                              <span *ngSwitchDefault>{{rowData[col.field]}}</span>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </p-tabPanel>

                <p-tabPanel header="Danh sách sản phẩm, dịch vụ">
                  <div class="row">
                    <div *ngIf="actionAdd && !isModeView && isNotReference" class="col-md-12" style="margin-bottom: 5px;">
                      <span (click)="addCustomerOrderDetail()">
                        <span>
                          <img src="/assets/icons/components/ios-add-circle-outline.svg" class="ios-add-circle-outline">
                        </span>
                        <span class="add-product-text">
                          Thêm sản phẩm dịch vụ
                        </span>
                      </span>
                    </div>

                    <div class="col-md-12 mt-5">
                      <p-table [columns]="selectedColumns" [value]="listLeadDetail" [scrollable]="true"
                        [resizableColumns]="true" selectionMode="single" (onRowSelect)="onRowSelect($event.data)"
                        [style]="{width:'100%'}" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10,50,100]"
                        [responsive]="true" class="table-border">
                        <ng-template pTemplate="caption">
                          <div class="row">
                            <div class="col-md-6" style="text-align:left">
                              <p-multiSelect [options]="cols" [(ngModel)]="selectedColumns"
                                [ngModelOptions]="{standalone: true}" optionLabel="header"
                                selectedItemsLabel="{0} cột được chọn" [style]="{minWidth: '200px'}"
                                defaultLabel="Chọn cột">
                              </p-multiSelect>
                            </div>
                          </div>
                        </ng-template>
                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col *ngFor="let col of columns" style="width: 150px;">
                          </colgroup>
                        </ng-template>
                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th style="width: 95px; text-align: center;">#</th>
                            <th *ngFor="let col of columns" pResizableColumn
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}">
                              {{col.header}}
                            </th>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-rowData let-columns="columns">
                          <tr [pSelectableRow]="rowData">
                            <td>
                              <button *ngIf="listLeadDetail?.length != 1" [disabled]="rowData.OrderNumber == 1"
                                class="btn-move mr-5" pTooltip="Chuyển lên" tooltipPosition="top" pButton
                                (click)="moveUp(rowData)"><i class="pi pi-arrow-up icons-move"></i></button>
                              <button *ngIf="listLeadDetail?.length != 1"
                                [disabled]="rowData.OrderNumber == listLeadDetail?.length" class="btn-move"
                                pTooltip="Chuyển xuống" tooltipPosition="top" pButton (click)="moveDown(rowData)"><i
                                  class="pi pi-arrow-down icons-move"></i></button>
                            </td>
                            <td *ngFor="let col of columns" class="ui-resizable-column"
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}" [ngSwitch]="col.field">
                              <span class="ui-column-title">{{col.header}}</span>
                              <span *ngSwitchCase="'ExplainStr'">
                                {{ rowData[col.field] == null || rowData[col.field] == '' ? rowData['Description'] :
                                rowData['ExplainStr']}}
                              </span>
                              <span *ngSwitchCase="'ProductNameUnit'">
                                {{ rowData['OrderDetailType'] == 0 ? rowData['ProductNameUnit'] :
                                rowData['IncurredUnit'] }}
                              </span>
                              <span *ngSwitchCase="'Quantity'">
                                {{rowData[col.field] | number}}
                              </span>
                              <span *ngSwitchCase="'UnitPrice'">
                                {{rowData[col.field] | number}}
                              </span>
                              <span *ngSwitchCase="'ExchangeRate'">
                                {{rowData[col.field] | number}}
                              </span>
                              <span *ngSwitchCase="'Vat'">
                                {{rowData[col.field] | number}}
                              </span>
                              <span *ngSwitchCase="'DiscountValue'">
                                {{rowData['DiscountType'] == true ? (((rowData[col.field] != null ? (rowData[col.field]
                                |
                                number) : '0')) + '%') : (rowData[col.field] | number)}}
                              </span>
                              <span *ngSwitchCase="'SumAmount'">
                                {{rowData[col.field] | number}}
                              </span>
                              <span *ngSwitchCase="'Delete'">
                                <button *ngIf="actionDelete && !isModeView && isNotReference" pButton icon="pi pi-trash"
                                  (click)="deleteItem(rowData)" class="ui-button-danger"></button>
                              </span>
                              <span *ngSwitchDefault>{{rowData[col.field]}}</span>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </p-tabPanel>

                <p-tabPanel header="Tài liệu đính kèm">
                  <div class="row">
                    <div *ngIf="!isModeView" class="col-md-12" style="display: flex; justify-content: flex-end;">
                      <span (click)="openAddLinkDialog()" class="link" style="margin-right: 5px;">
                        <span>
                          <img src="/assets/icons/components/ios-add-circle-outline.svg" class="ios-add-circle-outline">
                        </span>
                        <span class="add-link-text">
                          Thêm liên kết
                        </span>
                      </span>
                      <span (click)="openAddFileDialog()" class="link">
                        <span>
                          <img src="/assets/icons/components/ios-add-circle-outline.svg" class="ios-add-circle-outline">
                        </span>
                        <span class="add-link-text">
                          Thêm tệp
                        </span>
                      </span>
                    </div>
                    <div class="col-md-12" style="margin-top: 5px;">
                      <p-table [columns]="colsDocument" [value]="listDocument" [responsive]="true" [paginator]="true"
                        [rows]="5" [resizableColumns]="true" class="table-border">
                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th *ngFor="let col of columns" pResizableColumn [ngStyle]="{'text-align': col.textAlign}">
                              {{col.header}}
                            </th>
                            <th style="width:4em"></th>
                            <th style="width:4em"></th>
                          </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-rowData let-columns="columns">
                          <tr>
                            <td *ngFor="let col of columns" class="ui-resizable-column" [ngSwitch]="col.field"
                              [ngStyle]="{'text-align': col.textAlign}">
                              <span class="ui-column-title">{{col.header}}</span>
                              <span *ngSwitchCase="'size'">
                                <ng-container *ngIf="convertFileSize(rowData[col.field])">
                                  {{rowData[col.field] / 1024 | number}} KB
                                </ng-container>
                                <ng-container *ngIf="!convertFileSize(rowData[col.field])">
                                </ng-container>
                              </span>
                              <span *ngSwitchCase="'createdDate'">
                                {{rowData[col.field] | date:'dd/MM/yyyy h:mm a'}}
                              </span>
                              <span *ngSwitchCase="'name'" [ngClass]="{'link': rowData['typeDocument'] == 'LINK' }"
                                (click)="openDocument(rowData)">
                                {{rowData[col.field]}}
                              </span>
                              <span *ngSwitchDefault>{{rowData[col.field]}}</span>
                            </td>
                            <td>
                              <button *ngIf="actionDelete && !isModeView" pButton icon="pi pi-trash" (click)="deleteDocument(rowData)"
                                class="ui-button-danger"></button>
                            </td>
                            <td>
                              <button
                                *ngIf="rowData['fileInFolderId'] && rowData['fileInFolderId'] != '00000000-0000-0000-0000-000000000000'"
                                pButton icon="pi pi-download" (click)="downloadDocument(rowData)"></button>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </p-tabPanel>

                <p-tabPanel header="Hồ sơ thầu">
                  <div class="row">
                    <div *ngIf="isShowButtonCreateHst" class="col-md-12"
                      style="margin-bottom: 5px; display: flex; justify-content: flex-end;">
                      <span (click)="createSaleBidding()">
                        <span>
                          <img src="/assets/icons/components/ios-add-circle-outline.svg" class="ios-add-circle-outline">
                        </span>
                        <span class="add-product-text">
                          Tạo Hồ sơ thầu
                        </span>
                      </span>
                    </div>
                    <div class="col-md-12 mt-5">
                      <p-table [value]="listSaleBiddingById" [columns]="selectedColumnsSaleBidding" [scrollable]="true"
                        [resizableColumns]="true" selectionMode="single" [style]="{width:'100%'}" [paginator]="true"
                        [rows]="10" [rowsPerPageOptions]="[10,50,100]" [responsive]="true" class="table-border">
                        <ng-template pTemplate="caption">
                          <div style="text-align:left">
                            <p-multiSelect [options]="colsSaleBidding" colsContacts
                              [(ngModel)]="selectedColumnsSaleBidding" [ngModelOptions]="{standalone: true}"
                              optionLabel="header" selectedItemsLabel="{0} cột được chọn" [style]="{minWidth: '200px'}"
                              defaultLabel="Chọn cột">
                            </p-multiSelect>
                          </div>
                        </ng-template>
                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col *ngFor="let col of columns" style="width: 150px;">
                          </colgroup>
                        </ng-template>
                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th *ngFor="let col of columns" pResizableColumn
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}">
                              {{col.header}}
                            </th>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-rowData let-columns="columns">
                          <tr [pSelectableRow]="rowData">
                            <td *ngFor="let col of columns" class="ui-resizable-column"
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}" [ngSwitch]="col.field">
                              <span class="ui-column-title">{{col.header}}</span>
                              <span *ngSwitchCase="'saleBiddingName'">
                                <a target="_blank"
                                  [routerLink]="['/sale-bidding/detail', {saleBiddingId:rowData.saleBiddingId}]">{{rowData[col.field]}}</a>
                              </span>

                              <span *ngSwitchCase="'valueBid'">
                                {{rowData[col.field] | number}}
                              </span>
                              <span *ngSwitchDefault>{{rowData[col.field]}}</span>
                            </td>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="summary">
                          <div style="text-align: right">
                            Tổng giá trị: {{totalAmountSaleBidding | number}}
                          </div>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </p-tabPanel>

                <p-tabPanel header="Báo giá">
                  <div class="row">
                    <div *ngIf="isShowButtonCreateQuote" class="col-md-12"
                      style="margin-bottom: 5px; display: flex; justify-content: flex-end;">
                      <span (click)="createQuote()">
                        <span>
                          <img src="/assets/icons/components/ios-add-circle-outline.svg" class="ios-add-circle-outline">
                        </span>
                        <span class="add-product-text">
                          Tạo báo giá
                        </span>
                      </span>
                    </div>
                    <div class="col-md-12 mt-5">
                      <p-table [value]="listQuoteById" [columns]="selectedColumnsQuote" [scrollable]="true"
                        [resizableColumns]="true" selectionMode="single" [style]="{width:'100%'}" [paginator]="true"
                        [rows]="10" [rowsPerPageOptions]="[10,50,100]" [responsive]="true" class="table-border">
                        <ng-template pTemplate="caption">
                          <div style="text-align:left">
                            <p-multiSelect [options]="colsQuote" colsContacts [(ngModel)]="selectedColumnsQuote"
                              [ngModelOptions]="{standalone: true}" optionLabel="header"
                              selectedItemsLabel="{0} cột được chọn" [style]="{minWidth: '200px'}"
                              defaultLabel="Chọn cột">
                            </p-multiSelect>
                          </div>
                        </ng-template>
                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col *ngFor="let col of columns" style="width: 150px;">
                          </colgroup>
                        </ng-template>
                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th *ngFor="let col of columns" pResizableColumn
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}">
                              {{col.header}}
                            </th>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-rowData let-columns="columns">
                          <tr [pSelectableRow]="rowData">
                            <td *ngFor="let col of columns" class="ui-resizable-column"
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}" [ngSwitch]="col.field">
                              <span class="ui-column-title">{{col.header}}</span>
                              <span *ngSwitchCase="'quoteCode'">
                                <a target="_blank"
                                  [routerLink]="['/customer/quote-detail', {quoteId:rowData.quoteId}]">{{rowData[col.field]}}</a>
                              </span>
                              <span *ngSwitchCase="'quoteDate'">
                                {{rowData[col.field] | date:'dd/MM/yyyy'}}
                              </span>
                              <span *ngSwitchCase="'expirationDate'">
                                {{rowData[col.field] | date:'dd/MM/yyyy'}}
                              </span>
                              <span *ngSwitchCase="'totalAmount'">
                                {{rowData[col.field] | number}}
                              </span>
                              <span *ngSwitchCase="'totalAmountAfterVat'">
                                {{rowData[col.field] | number}}
                              </span>
                              <span *ngSwitchDefault>{{rowData[col.field]}}</span>
                            </td>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="summary">
                          <div style="text-align: right">
                            Tổng giá trị: {{totalAmountQuote | number}}
                          </div>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </p-tabPanel>

                <p-tabPanel header="Đơn hàng">
                  <div class="row">
                    <div class="col-md-12 mt-5">
                      <p-table [value]="listOrder" [columns]="selectedColumnsOrder" [scrollable]="true"
                        [resizableColumns]="true" selectionMode="single" [style]="{width:'100%'}" [paginator]="true"
                        [rows]="10" [rowsPerPageOptions]="[10,50,100]" [responsive]="true" class="table-border">
                        <ng-template pTemplate="caption">
                          <div style="text-align:left">
                            <p-multiSelect [options]="colsOrder" colsContacts [(ngModel)]="selectedColumnsOrder"
                              [ngModelOptions]="{standalone: true}" optionLabel="header"
                              selectedItemsLabel="{0} cột được chọn" [style]="{minWidth: '200px'}"
                              defaultLabel="Chọn cột">
                            </p-multiSelect>
                          </div>
                        </ng-template>
                        <ng-template pTemplate="colgroup" let-columns>
                          <colgroup>
                            <col *ngFor="let col of columns" style="width: 150px;">
                          </colgroup>
                        </ng-template>
                        <ng-template pTemplate="header" let-columns>
                          <tr>
                            <th *ngFor="let col of columns" pResizableColumn
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}">
                              {{col.header}}
                            </th>
                          </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-rowData let-columns="columns">
                          <tr [pSelectableRow]="rowData">
                            <td *ngFor="let col of columns" class="ui-resizable-column"
                              [ngStyle]="{'width': col.width, 'text-align': col.textAlign}" [ngSwitch]="col.field">
                              <span class="ui-column-title">{{col.header}}</span>
                              <!-- <span *ngSwitchCase="'orderCode'">
                                <a target="_blank"
                                  [routerLink]="['/order/order-detail', {customerOrderID:rowData['orderId']}]">{{rowData[col.field]}}</a>
                              </span> -->


                              <span *ngSwitchCase="'orderCode'" (click)="goToOrderDetail(rowData['orderId'])" class="link">
                                {{rowData[col.field]}}                              
                              </span>


                              
                              <span *ngSwitchCase="'orderDate'">
                                {{rowData[col.field] | date:'dd/MM/yyyy'}}
                              </span>
                              <span *ngSwitchCase="'amount'">
                                {{rowData[col.field] | number}}
                              </span>
                              <span *ngSwitchDefault>{{rowData[col.field]}}</span>
                            </td>
                          </tr>
                        </ng-template>
                      </p-table>
                    </div>
                  </div>
                </p-tabPanel>
              </p-tabView>
            </p-accordionTab>
          </p-accordion>
        </div>
      </div>
    </div>

    <div class="row no-margin" style="padding-top: 10px; padding-bottom: 10px;" #note>
      <div class="col-md-12 lead-contact">
        <div class="row">
          <p-accordion expandIcon="pi pi-fw pi-chevron-circle-right" collapseIcon="pi pi-fw pi-chevron-circle-down">
            <p-accordionTab header="Ghi chú" [selected]="true">
              <div class="col-md-12">
                <p-editor [(ngModel)]="noteContent" [ngModelOptions]="{standalone: true}"
                  [style]="{'height':'180px', 'width': '100%'}" (onTextChange)="changeNoteContent($event)">
                </p-editor>
              </div>
              <div *ngIf="actionImport" class="col-md-12" style="margin-top: 5px;">
                <p-fileUpload #fileUpload name="demo[]" [showUploadButton]="false" multiple="multiple"
                  accept="image/*,video/*,audio/*,.zip,.rar,.pdf,.xls,.xlsx,.doc,.docx,.ppt,.pptx,.txt"
                  maxFileSize="10000000" invalidFileSizeMessageSummary="{0}: file kích cỡ quá lớn,"
                  invalidFileSizeMessageDetail="kích cỡ lớn nhất có thể lưu là {0}."
                  invalidFileTypeMessageSummary="{0}: định dạng file bị cấm, "
                  invalidFileTypeMessageDetail="bạn chỉ có thể lưu các file có định dạng như: {0}."
                  chooseLabel="Chọn file" cancelLabel="Hủy toàn bộ file" (onSelect)="handleFile($event, fileUpload)"
                  (onRemove)="removeFile($event)" (onClear)="clearAllFile()"></p-fileUpload>
              </div>

              <div *ngIf="(listUpdateNoteDocument.length > 0)" class="col-md-12" style="margin-top: 5px;">
                <p-table [columns]="colsFile" [value]="listUpdateNoteDocument" [responsive]="true"
                  [resizableColumns]="true" class="table-border">
                  <ng-template pTemplate="header" let-columns>
                    <tr>
                      <th *ngFor="let col of columns" pResizableColumn [ngStyle]="{'text-align': col.textAlign}">
                        {{col.header}}
                      </th>
                      <th style="width:4em"></th>
                      <th style="width:4em"></th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-rowData let-columns="columns">
                    <tr>
                      <td *ngFor="let col of columns" class="ui-resizable-column"
                        [ngStyle]="{'text-align': col.textAlign}">
                        <span class="ui-column-title">{{col.header}}</span>
                        <span>{{rowData[col.field]}}</span>
                      </td>
                      <td>
                        <button *ngIf="actionDelete" pButton icon="pi pi-trash" (click)="deleteFile(rowData)"
                          class="ui-button-danger"></button>
                      </td>
                      <td>
                        <button pButton icon="pi pi-download" (click)="downloadFile(rowData)"></button>
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
              <div class="col-md-12" style="text-align: right; margin-top: 5px;">
                <button type="button" class="btn-cancel-note" (click)="cancelNote()">
                  <span class="save-cancel-lable">Hủy</span>
                </button>
                <button type="button" class="btn-save-note" (click)="saveNote()">
                  <span class="save-note-lable">{{isEditNote == true ? 'Cập nhật ghi chú' : 'Thêm ghi chú'}}</span>
                </button>
              </div>
            </p-accordionTab>
          </p-accordion>
        </div>
      </div>
    </div>

    <div class="row no-margin" style="padding-top: 10px; padding-bottom: 10px;" #time>
      <div class="col-md-12 time-line">
        <div class="row">
          <p-accordion expandIcon="pi pi-fw pi-chevron-circle-right" collapseIcon="pi pi-fw pi-chevron-circle-down">
            <p-accordionTab header="Dòng thời gian" [selected]="true">
              <div class="timeline col-md-12 timeline-content">
                <ul class="timeline">
                  <li *ngFor="let note of noteHistory;let noteIndex = index;">
                    <i *ngIf="note.type == 'ADD'" class="fa fa-file-text-o bg-blueX color-w"></i>
                    <i *ngIf="note.type == 'NOT'" class="fa fa-commenting-o bg-blueX color-w"></i>
                    <i *ngIf="note.type == 'EDT'" class="fa fa-user bg-blueX color-w"></i>
                    <i *ngIf="note.type == 'NEW'" class="fa fa-user-plus bg-blueX color-w"></i>
                    <div class="timeline-item" id="{{note.noteId}}">
                      <span class="time onHover">
                        <i *ngIf="note.type === 'ADD' && ((note.description !== '' && note.description !== null) || note.noteDocList.length > 0) && actionEdit"
                          (click)="onClickEditNote(note.noteId, note.description)" class="pi pi-pencil style-edit"
                          pTooltip="{{ 'lead.tooltip.edit_note' | translate }}" tooltipPosition="bottom"></i>
                        <i *ngIf="actionDelete" pTooltip="Xóa ghi chú" tooltipPosition="bottom"
                          (click)="onClickDeleteNote(note.noteId)" class="pi pi-trash style-delete"></i>
                      </span>
                      <h3 class="timeline-header">
                        <span>
                          <i *ngIf="tooLong(note)" class="trigger_node collapse-content-icon pi pi-chevron-right"
                            (click)="trigger_node(note.noteId,$event)" style="cursor: pointer;"
                            pTooltip="{{ toggle_note_label }}" tooltipPosition="bottom"></i>
                          <span class="alignment" style="padding: 0 12px;" *ngIf="!tooLong(note)"></span>
                        </span>
                        <div>
                          <img *ngIf="note" [src]="defaultAvatar" height="30" width="30" alt=""
                            class="timeline-user-avatar" />
                        </div>
                        <span class="note-user">{{note.responsibleName}}</span>
                        <p class="time-note">
                          {{note.noteTitle}} Lúc {{note.createdDate | date:'HH:mm'}} {{ 'lead.note.day' | translate }}
                          {{note.createdDate | date:'dd/MM/yyyy'}}
                        </p>
                      </h3>
                      <div class="timeline-body">
                        <div class="note-content">
                          <span class="short-content" style="word-wrap: break-word;"></span>
                          <span class="full-content" style="display: none;word-wrap: break-word;"></span>
                        </div>

                        <div *ngIf="note.noteDocList.length > 0" class="row no-margin file-upload-zone"
                          style="padding: 0 12px; margin-bottom: 20px !important">
                          <div *ngFor="let item of note.noteDocList.slice(0,3); let i=index"
                            class="col-md-4 short-content-file" style="padding: 5px 0">
                            <div class="row no-margin file-item"
                              style="background-color: rgb(228, 228, 228); padding: 5px 10px">
                              <div class="col-md-1">
                                <i class="pi pi-file" style="font-size: 1.55em;"></i>
                              </div>
                              <div class="col-md-11">
                                <div class="item-name" pTooltip="{{ item.documentName }}" tooltipPosition="bottom">
                                  <span>
                                    <a class="preview-doc" (click)="openItem(item.documentName, item.documentUrl)">
                                      {{ item.documentName }}
                                    </a>
                                  </span>
                                </div>
                                <div style="font-size: 10px; padding: 0 !important">
                                  {{ (item.documentSize)/1024/1024 | number:'.2' }} MB
                                </div>
                              </div>
                            </div>
                          </div>
                          <div *ngFor="let item of note.noteDocList;let i=index" class="col-md-4 full-content-file"
                            style="display: none;padding: 5px 0">
                            <div class="row no-margin file-item"
                              style="background-color: rgb(228, 228, 228); padding: 5px 10px">
                              <div class="col-md-1">
                                <i class="pi pi-file" style="font-size: 1.55em;"></i>
                              </div>
                              <div class="col-md-11">
                                <div class="item-name" pTooltip="{{ item.documentName }}" tooltipPosition="bottom">
                                  <span>
                                    <a class="preview-doc" (click)="openItem(item.base64Url)">
                                      {{ item.documentName }}
                                    </a>
                                  </span>
                                </div>
                                <div style="font-size: 10px; padding: 0 !important">
                                  {{ item.documentSize/1024/1024 | number:'.2' }} MB
                                </div>
                              </div>
                            </div>
                          </div>
                          <p *ngIf="note.noteDocList.length > 3" class="col-md-12 continue"><b>...</b></p>
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </p-accordionTab>
          </p-accordion>
        </div>
      </div>
    </div>
  </form>
</div>

<!-- dialog -->
<p-dialog header="Đính kèm tệp" [(visible)]="displayAttachFile" [style]="{width: '50vw'}" [baseZIndex]="10000">
  <div class="attach-file-dialog">
    <div class="col-md-12">
      <div *ngIf="actionImport" class="col-md-12 mt-5">
        <p-fileUpload #fileUpload name="demo[]" [showUploadButton]="false" multiple="multiple"
          accept="image/*,video/*,audio/*,.zip,.rar,.pdf,.xls,.xlsx,.doc,.docx,.ppt,.pptx,.txt" maxFileSize="10000000"
          invalidFileSizeMessageSummary="{0}: file kích cỡ quá lớn,"
          invalidFileSizeMessageDetail="kích cỡ lớn nhất có thể lưu là {0}."
          invalidFileTypeMessageSummary="{0}: định dạng file bị cấm, "
          invalidFileTypeMessageDetail="bạn chỉ có thể lưu các file có định dạng như: {0}." chooseLabel="Chọn file"
          cancelLabel="Hủy toàn bộ file" (onSelect)="handleFile($event, fileUpload)" (onRemove)="removeFile($event)"
          (onClear)="clearAllFile()">
        </p-fileUpload>
      </div>
    </div>
  </div>
  <p-footer>
    <button type="button" pButton icon="pi pi-times" (click)="closeAddFileDialog()" label="Hủy bỏ"
      class="ui-button-secondary"></button>
    <button type="button" pButton icon="pi pi-check" (click)="addFileToTable()" label="Đính kèm"></button>
  </p-footer>
</p-dialog>

<p-dialog header="Đính kèm liên kết" [(visible)]="displayAttachLink" [style]="{width: '30vw'}" [baseZIndex]="10000">
  <div class="attach-link-dialog">
    <div class="row no-margin">
      <form [formGroup]="addLinkForm">
        <div class="row buffer-bottom" style="width: 100%; margin: 15px auto;">
          <div class="col-md-12 buffer-bottom-label">
            <span>Tên liên kết</span>
          </div>
          <div class="col-md-12">
            <input formControlName="NameOfLink" style="width: 100%;"
              [ngClass]="(addLinkForm.get('NameOfLink').invalid && (addLinkForm.get('NameOfLink').dirty || addLinkForm.get('NameOfLink').touched)) ? 'error-border' : ''"
              type="text" pInputText placeholder="" (keydown.enter)="$event.preventDefault()" />
          </div>
          <div class="col-md-12"
            [hidden]="addLinkForm.get('NameOfLink').valid || addLinkForm.get('NameOfLink').untouched">
            <span *ngIf="addLinkForm.get('NameOfLink').hasError('required')" class="error-message-span">Nhập tên liên
              kết</span>
          </div>
        </div>
        <div class="row buffer-bottom" style="width: 100%; margin: 15px auto;">
          <div class="col-md-12 buffer-bottom-label">
            <span>Địa chỉ liên kết</span>
          </div>
          <div class="col-md-12">
            <input formControlName="Link" style="width: 100%;"
              [ngClass]="(addLinkForm.get('Link').invalid && (addLinkForm.get('Link').dirty || addLinkForm.get('Link').touched)) ? 'error-border' : ''"
              type="text" pInputText placeholder="" (keydown.enter)="$event.preventDefault()" />
          </div>
          <div class="col-md-12" [hidden]="addLinkForm.get('Link').valid || addLinkForm.get('Link').untouched">
            <span *ngIf="addLinkForm.get('Link').hasError('required')" class="error-message-span">Nhập địa chỉ liên
              kết</span>
          </div>
        </div>
      </form>
    </div>
  </div>
  <p-footer>
    <button type="button" pButton icon="pi pi-times" (click)="closeAddLinkDialog()" label="Hủy bỏ"
      class="ui-button-secondary"></button>
    <button type="button" pButton icon="pi pi-check" (click)="addLinkToTable()" label="Đính kèm"></button>
  </p-footer>
</p-dialog>