<div class="loading-indicator" *ngIf="loading">
  <p-progressSpinner [style]="{width: '50px', height: '50px'}" strokeWidth="8" fill="#EEEEEE" animationDuration=".5s">
  </p-progressSpinner>
</div>

<p-toast position="bottom-right"></p-toast>
<!-- Confirm... -->
<p-confirmDialog header="Xác nhận" icon="pi pi-exclamation-triangle" acceptLabel="Chấp nhận" rejectLabel="Không">
</p-confirmDialog>

<div class="layout-project">
  <app-top-header-project></app-top-header-project>

  <div class="wrapper" style="height: auto;">
    <!-- <main-header></main-header> -->
    <app-project-header></app-project-header>
    <!-- Menu Left -->
    <app-menu-left-project></app-menu-left-project>

    <!-- Content -->
    <div class="content-wrapper" style="height: auto; min-height: calc(100vh - 100px);">
      <section class="row content">
        <div class="project-scope col-md-12">
          <div class="row no-margin">
            <div class="col-md-12 header" style="padding: 6px;">
              <div class="row">
                <div class="col-md-8 no-padding">
                  <div class="row no-margin">
                    <div class="col-md-12">
                      <div class="header-title">
                        <!-- <span class="project-name">[{{project.projectCode}}]:{{project.projectName}}</span> -->
                        <p-dropdown [options]="listProjectTitle" optionLabel="projectCodeName" placeholder="Chọn dự án"
                          [filter]="true" [resetFilterOnHide]="true" [virtualScroll]="true" itemSize="10"
                          [(ngModel)]="selectedProject" (onChange)="onChangeProject($event.value.projectId)"
                          (keydown.enter)="$event.preventDefault()">
                        </p-dropdown>
                      </div>
                      <div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="row">
                    <div class="col-md-12" style="display: flex; justify-content: flex-end; margin-top: 5px">
                      <div style="padding-right: 10px">
                        <span *ngIf="!isInvalidForm">
                          <img src="/assets/icons/components/ios-warning.svg" class="ios-warning" />
                        </span>
                        <div class="box-waring" *ngIf="isInvalidForm" #toggleButton (click)="toggleNotifiError()">
                          <img src="/assets/icons/components/ios-warning-active.svg" class="ios-warning-active" />
                        </div>
                        <div class="notification" #notifi *ngIf="isOpenNotifiError">
                          <div *ngIf="((scopeProjectForm.get('projectScopeNameControl').hasError('required')))"
                            class="notifi-row" (click)="scroll(boxTaskName)">
                            <img src="/assets/icons/components/ios-alert.svg" class="ios-alert">
                            <span class="notifi-text">Chưa nhập tên hạng mục</span>
                          </div>
                          <div *ngIf="((scopeProjectForm.get('resourceTypeControl')?.errors?.forbiddenSpaceText))"
                            class="notifi-row" (click)="scroll(boxTaskName)">
                            <img src="/assets/icons/components/ios-alert.svg" class="ios-alert">s
                            <span class="notifi-text">Chưa chọn loại nguồn lực</span>
                          </div>
                        </div>
                      </div>
                      <button (click)="cancel()" type="button" class="btn-remove">
                        <span class="btn-remove-text">Thoát</span>
                      </button>
                      <button class="cancel" type="button" (click)="showProjectInfor()" *ngIf="!isShow">
                        <span class="text-cancel"><i class="fa fa-bars" aria-hidden="true"></i>&nbsp; Thông tin dự
                          án</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- PANEL THÔNG TIN CHUNG CỦA DỰ ÁN -->
          <app-project-information-panel></app-project-information-panel>

          <div [formGroup]="projectScopeForm">
            <div class="row no-margin" style="padding-top: 10px;padding-bottom: 10px;">
              <div class="col-md-12 no-padding">
                <p-accordion expandIcon="pi pi-fw pi-chevron-circle-right"
                  collapseIcon="pi pi-fw pi-chevron-circle-down">
                  <p-accordionTab header="Hạng mục dự án" [selected]="true">
                    <div class="row">
                      <div class="col-md-12" style="display: flex; justify-content: flex-end; margin-bottom: 8px;">
                        <button *ngIf="actionCopyScope == true" type="ui-button-info" style="width: 150px;"
                          class="btn-filter" (click)="copyProjectResource()">
                          <span class="btn-filter-text">Copy hạng mục</span>
                        </button>

                        <p-splitButton label="Thêm mới" [model]="listAction" styleClass="ui-button-info"
                          [style]="{'margin-left': '5px'}"></p-splitButton>
                      </div>

                      <div class="col-md-12 project-infor">
                        <div class="row">
                          <div class="col-md-12 body" style="margin-top:10px">
                            <div class="row">
                              <div class="col-md-12 bank-infop">
                                <div class="row">
                                  <div class="col-md-12 block" style="overflow-x: auto; padding: 10px 0px;">
                                    <p-organizationChart [value]="data" selectionMode="single"
                                      [(selection)]="selectedNode" (onNodeSelect)="onNodeSelect($event)"
                                      (onNodeUnselect)="onNodeUnselect($event)">
                                    </p-organizationChart>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </p-accordionTab>
                </p-accordion>
              </div>
            </div>

            <div class="row no-margin" style="padding-top: 10px;padding-bottom: 10px;">
              <div class="col-md-12 no-padding">
                <p-accordion expandIcon="pi pi-fw pi-chevron-circle-right"
                  collapseIcon="pi pi-fw pi-chevron-circle-down">
                  <p-accordionTab header="Thông tin hạng mục" [selected]="true">
                    <div class="row" style="margin-left:30px; margin-bottom:20px">
                      <span>Hạng mục trực thuộc: </span><span style="font-weight:bold">{{parentName}}</span>
                    </div>
                    <p-tabView>
                      <p-tabPanel header="Thông tin hạng mục"
                        [headerStyle]="{width: 'fit-content', 'text-align': 'center'}">
                        <form [formGroup]="scopeProjectForm">
                          <div style="display:flex; justify-content:flex-end">
                            <i class="pi pi-trash" *ngIf="isDelete" style="font-size: 24px;"
                              (click)="delete_projectResource()"></i>
                            <i class="pi pi-pencil" style="font-size: 24px;" (click)="editProjectScope()"></i>
                            <i class="pi pi-save" *ngIf="isEdit" style="font-size: 24px;"
                              (click)="saveProjectScope()"></i>
                          </div>
                          <div class="row">
                            <div class="col-md-12">
                              <div class="row">
                                <div class="col-md-5">
                                  <div class="col-md-12">
                                    <div class="row buffer-bottom">
                                      <div class="col-md-12 buffer-bottom-label">
                                        <span>Tên gói công việc</span><span class="required">*</span>
                                      </div>
                                      <div class="col-md-12">
                                        <input formControlName="projectScopeNameControl" type="text"
                                          [ngClass]="(scopeProjectForm.get('projectScopeNameControl').invalid && (scopeProjectForm.get('projectScopeNameControl').dirty || scopeProjectForm.get('projectScopeNameControl').touched)) ? 'error-border' : ''"
                                          class="w100" pInputText />
                                      </div>
                                      <div class="col-md-12"
                                        [hidden]="scopeProjectForm.get('projectScopeNameControl').valid || scopeProjectForm.get('projectScopeNameControl').untouched">
                                        <span
                                          *ngIf="scopeProjectForm.get('projectScopeNameControl').hasError('required') || scopeProjectForm.get('projectScopeNameControl').hasError('blankString') "
                                          class="error-message-span">
                                          Không được
                                          để trống
                                        </span>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="col-md-12">
                                    <div class="row buffer-bottom">
                                      <div class="col-md-12 buffer-bottom-label">
                                        <span>Loại nguồn lực</span><span class="required">*</span>
                                      </div>
                                      <div class="col-md-12">
                                        <p-dropdown [options]="listResourceType" formControlName="resourceTypeControl"
                                          [autoDisplayFirst]="false"
                                          [styleClass]="(resourceTypeControl.invalid && (resourceTypeControl.dirty || resourceTypeControl.touched)) ? 'error-border' : ''"
                                          [filter]="true" [showClear]="true" [resetFilterOnHide]="true"
                                          placeholder="Chọn loại nguồn lực" optionLabel="categoryName"
                                          [style]="{'width': '100%'}">
                                        </p-dropdown>
                                        <div class="col-md-12"
                                          [hidden]="resourceTypeControl.valid || resourceTypeControl.untouched">
                                          <span *ngIf="resourceTypeControl.hasError('required')"
                                            class="error-message-span">Chưa chọn
                                            nguồn lực</span>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="col-md-12">
                                    <div class="row buffer-bottom">
                                      <div class="col-md-12 buffer-bottom-label">
                                        <span>Ước lượng thời gian công việc: {{thoiGianUocLuong | number}} giờ</span>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-7">
                                  <div class="col-md-12">
                                    <div class="row buffer-bottom">
                                      <div class="col-md-12 buffer-bottom-label">
                                        <span>Mô tả</span>
                                      </div>
                                      <div class="col-md-12">
                                        <ejs-richtexteditor #templateRTE [height]="300" [toolbarSettings]='tools'
                                          formControlName="projectScopeDescriptionControl" [readonly]="isReadonly">
                                          <ng-template>
                                          </ng-template>
                                        </ejs-richtexteditor>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-md-12">
                                  <div class="row buffer-bottom">
                                    <div class="col-md-12 buffer-bottom-label">
                                      <span>Nguồn lực</span>
                                    </div>
                                    <div class="col-md-12" *ngIf="listResourceScope.length > 0">
                                      <span *ngFor="let item of listResourceScope" class="list-resource-name">
                                        {{item}}
                                      </span>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </form>
                      </p-tabPanel>
                      <p-tabPanel header="Danh sách công việc"
                        [headerStyle]="{width: 'fit-content', 'text-align': 'center'}">
                        <div class="row">
                          <div class="col-md-12 mt-5" style="display:flex;justify-content:flex-end; margin-bottom: 5px;">
                            <button type="button" class="btn-filter" (click)="showFilter()">
                              <img src="/assets/icons/components/ios-funnel.svg" class="ios-funnel">
                              <span class="btn-filter-text">Bộ lọc</span>
                            </button>
                            <button pButton type="button" style="margin-left: 5px;" (click)="add_Task()"
                              label="Thêm mới"></button>
                          </div>
                          <div class="col-md-12 mt-5">
                            <div class="row no-margin" style="background-color: #f2f4f8;">
                              <div *ngIf="listProjectTasks.length > 0" class="col-md-{{leftColNumber}} no-padding">
                                <p-table #myTable [columns]="selectedColumns" [value]="listProjectTasks"
                                  [resizableColumns]="true" selectionMode="single" [(selection)]="selectedItem"
                                  (onRowSelect)="onRowSelect($event.data)" [style]="{width:'100%'}" [paginator]="true"
                                  [rows]="10" [rowsPerPageOptions]="[10,50,100]" responsive="true" class="table-border">
                                  <ng-template pTemplate="header" let-columns>
                                    <tr>
                                      <th style="text-align: left; width: 5%;">
                                        <span>Mã</span>
                                      </th>
                                      <th *ngFor="let col of selectedColumns" pResizableColumn [pSortableColumn]="col.field"
                                        [ngStyle]="{'text-align': col.textAlign, 'display': col.display, 'width': col.width }">
                                        <span>
                                          {{col.header}}
                                          <p-sortIcon [field]="col.field"></p-sortIcon>
                                        </span>
                                      </th>
                                      <th style="text-align: center; width: 100px;">
                                        <span>Thao tác</span>
                                      </th>
                                    </tr>
                                  </ng-template>
                                  <ng-template pTemplate="body" let-rowData let-columns="columns">
                                    <tr [pSelectableRow]="rowData">
                                      <td style="text-align: left;">
                                        <span>
                                          {{rowData['taskCode']}}
                                        </span>
                                      </td>
                                      <td *ngFor="let col of selectedColumns" class="ui-resizable-column"
                                        [ngStyle]="{'width': col.width, 'text-align': col.textAlign}"
                                        [ngSwitch]="col.field">
    
                                        <span *ngSwitchCase="'taskName'" pTooltip="{{rowData[col.field]}}"
                                          tooltipPosition="bottom">
                                          {{rowData[col.field]}}
                                        </span>
    
                                        <span *ngSwitchCase="'scopeName'" pTooltip="{{rowData[col.field]}}"
                                          tooltipPosition="bottom">
                                          {{rowData[col.field]}}
                                        </span>
    
                                        <span *ngSwitchCase="'employee'" id="{{rowData['taskId']}}"
                                          pTooltip="{{rowData[col.field]}}" tooltipPosition="bottom"
                                          style="word-wrap: break-word;">
                                          <!-- {{rowData[col.field]}} -->
                                        </span>
                                        <span *ngSwitchCase="'statusName'"
                                          [ngStyle]="{'background-color': rowData['backgroundColorForStatus']}" style="display: inline-block;
                                      padding: 3px 3px;
                                      color: black;
                                      width: 100%;" pTooltip="{{rowData[col.field]}}" tooltipPosition="bottom">
                                          {{rowData[col.field]}}
                                        </span>
    
                                        <span *ngSwitchCase="'taskComplate'" pTooltip="{{rowData[col.field]}}"
                                          tooltipPosition="bottom">
                                          {{rowData[col.field]}}
                                        </span>
    
                                        <span *ngSwitchCase="'planStartTime'">
                                          {{ rowData[col.field] | date:'dd/MM/yyyy'}}
                                        </span>
                                        <span *ngSwitchCase="'planEndTime'">
                                          {{ rowData[col.field] | date:'dd/MM/yyyy'}}
                                        </span>
                                        <span *ngSwitchDefault>{{rowData[col.field]}}</span>
                                      </td>
                                      <td style="text-align: center;">
                                        <div class="col-md-5">
                                          <span class="link" (click)="delete_Task(rowData)">Xóa</span>
                                        </div>
                                        <div class="col-md-2"></div>
                                        <div class="col-md-5">
                                          <span class="link" (click)="edit_Task(rowData)">Sửa</span>
                                        </div>
                                      </td>
                                    </tr>
                                  </ng-template>
                                </p-table>
                              </div>
    
                              <div *ngIf="(listProjectTasks.length == 0)"
                                class="col-md-{{leftColNumber}} no-padding no-data">
                                <div class="box-no-data">
                                  <img src="/assets/icons/components/box.svg" class="box-icon">
                                  <div>
                                    <span>Hiện tại không có dữ liệu</span>
                                  </div>
                                </div>
                              </div>
    
                              <div *ngIf="isShowFilterLeft" class="col-md-{{rightColNumber}} no-padding">
                                <div class="box-filter">
                                  <div class="row no-margin">
                                    <div class="col-md-12">
                                      BỘ LỌC DỮ LIỆU
                                    </div>
                                  </div>
                                  <!-- TRẠNG THÁI -->
                                  <div class="row no-margin mt-5">
                                    <div class="col-md-12">
                                      <span>Trạng thái</span>
                                    </div>
                                    <div class="col-md-12">
                                      <p-multiSelect [options]="listStatus" [(ngModel)]="selectedStatus"
                                        defaultLabel="Chọn trạng thái" optionLabel="categoryName"
                                        [style]="{'width': '100%'}" [ngModelOptions]="{standalone: true}"
                                        [resetFilterOnHide]="true" selectedItemsLabel="{0} trạng thái được chọn">
                                      </p-multiSelect>
                                    </div>
                                  </div>
                                  <!-- GÓI CÔNG VIỆC -->
                                  <div class="row no-margin mt-5">
                                    <div class="col-md-12">
                                      <span>Gói công việc</span>
                                    </div>
                                    <div class="col-md-12 ">
                                      <p-multiSelect [options]="listWorkpackage" [(ngModel)]="selectedWorkpackage"
                                        [ngModelOptions]="{standalone: true}" optionLabel="projectScopeName"
                                        defaultLabel="Gói công việc trực thuộc" [style]="{'width': '100%'}"
                                        [resetFilterOnHide]="true" selectedItemsLabel="{0} gói công việc được chọn">
                                      </p-multiSelect>
                                    </div>
                                  </div>
                                  <!-- NGƯỜI PHỤ TRÁCH -->
                                  <div class="row no-margin mt-5">
                                    <div class="col-md-12 ">
                                      <span>Người phụ trách</span>
                                    </div>
                                    <div class="col-md-12">
                                      <p-multiSelect [options]="listPersionInCharged" [(ngModel)]="selectedPic"
                                        [ngModelOptions]="{standalone: true}" defaultLabel="Chọn người phụ trách"
                                        optionLabel="employeeName" [style]="{'width': '100%'}" [resetFilterOnHide]="true"
                                        selectedItemsLabel="{0} người phụ trách được chọn">
                                      </p-multiSelect>
                                    </div>
                                  </div>
                                  <!-- PHẦN TRĂM HOÀN THÀNH -->
                                  <div class="row no-margin mt-5">
                                    <div class="col-md-12">
                                      <span>% hoàn thành</span>
                                    </div>
                                    <div class="col-md-12">
                                      <div class="col-md-6">
                                        <input type="text" placeholder="" [(ngModel)]="fromPercent" class="number-input"
                                          max="100" [ngModelOptions]="{standalone: true}" [style]="{'margin-left': '-15px'}"
                                          [cleave]="{numeral: true, numeralPositiveOnly: true, numeralDecimalScale: 'defaultNumberType'}">
                                      </div>
    
                                      <div class="col-md-6">
                                        <input type="text" placeholder="" [(ngModel)]="toPercent" class="number-input"
                                          max="100" [ngModelOptions]="{standalone: true}" [style]="{'margin-left': '15px'}"
                                          [cleave]="{numeral: true, numeralPositiveOnly: true, numeralDecimalScale: 'defaultNumberType'}">
                                      </div>
                                    </div>
                                  </div>
                                  <!-- NGÀY BẮT ĐẦU -->
                                  <div class="row no-margin mt-5">
    
                                    <div class="col-md-12">
                                      <span>Ngày bắt đầu dự tính</span>
                                    </div>
                                    <div class="col-md-12">
                                      <div class="col-md-6">
                                        <p-calendar [(ngModel)]="startFromDate" [yearNavigator]="true"
                                          yearRange="{{minYear}}:{{currentYear}}" dateFormat="dd/mm/yy"
                                          [maxDate]="startToDate" placeholder="Từ ngày" [style]="{'margin-left': '-15px'}"
                                          [ngModelOptions]="{standalone: true}" showButtonBar="true"
                                          [inputStyle]="{'width':'89%'}" [baseZIndex]="9999">
                                        </p-calendar>
                                      </div>
                                      <div class="col-md-6">
                                        <p-calendar [(ngModel)]="startToDate" [yearNavigator]="true"
                                          yearRange="{{minYear}}:{{currentYear}}" dateFormat="dd/mm/yy"
                                          [minDate]="startFromDate" placeholder="Đến ngày"
                                          [ngModelOptions]="{standalone: true}" [style]="{'width':'100%'}"
                                          showButtonBar="true" [inputStyle]="{'margin-left': '15px','width':'100%'}"
                                          [baseZIndex]="9999">
                                        </p-calendar>
                                      </div>
                                    </div>
                                  </div>
                                  <!-- NGÀY KẾT THÚC -->
                                  <div class="row no-margin mt-5">
    
                                    <div class="col-md-12">
                                      <span>Ngày kết thúc dự tính</span>
                                    </div>
                                    <div class="col-md-12">
                                      <div class="col-md-6">
                                        <p-calendar [(ngModel)]="endFromDate" [yearNavigator]="true"
                                          yearRange="{{minYear}}:{{currentYear}}" dateFormat="dd/mm/yy"
                                          [maxDate]="endToDate" placeholder="Từ ngày" [style]="{'margin-left': '-15px'}"
                                          [ngModelOptions]="{standalone: true}" showButtonBar="true"
                                          [inputStyle]="{'width':'89%'}" [baseZIndex]="9999"></p-calendar>
                                      </div>
                                      <div class="col-md-6">
                                        <p-calendar [(ngModel)]="endToDate" [yearNavigator]="true"
                                          yearRange="{{minYear}}:{{currentYear}}" dateFormat="dd/mm/yy"
                                          [style]="{'width':'100%'}" [minDate]="endFromDate" placeholder="Đến ngày"
                                          [ngModelOptions]="{standalone: true}" showButtonBar="true"
                                          [inputStyle]="{'margin-left': '15px','width':'100%'}" [baseZIndex]="9999">
                                        </p-calendar>
                                      </div>
                                    </div>
                                  </div>
    
                                  <div class="row no-margin pb-1">
                                    <div class="col-md-12 mt-5" style="text-align: right;margin-top: 10px;">
                                      <button type="button" class="btn-search" (click)="searchTask()">
                                        <span class="btn-search-text">Tìm kiếm</span>
                                      </button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </p-tabPanel>
                    </p-tabView>
                  </p-accordionTab>
                </p-accordion>
              </div>
            </div>

            <div class="row no-margin" style="padding-top: 10px; padding-bottom: 10px;" #time>
              <div class="col-md-12 no-padding time-line">
                <div class="row">
                  <p-accordion expandIcon="pi pi-fw pi-chevron-circle-right" class="col-md-12"
                    collapseIcon="pi pi-fw pi-chevron-circle-down">
                    <p-accordionTab header="Ghi chú" [selected]="true">
                      <div class='row'>
                        <div class="col-md-12">
                          <p-editor [(ngModel)]="noteContent" [ngModelOptions]="{standalone: true}"
                            [style]="{'height':'180px', 'width': '100%'}" (onTextChange)="changeNoteContent($event)">
                          </p-editor>
                        </div>
                        <!-- <div class="col-md-12" style="margin-top: 5px;">
                      <p-fileUpload #fileUploadNote name="demo[]" [showUploadButton]="false" multiple="multiple"
                        accept="image/*,video/*,audio/*,.zip,.rar,.pdf,.xls,.xlsx,.doc,.docx,.ppt,.pptx,.txt"
                        maxFileSize="10000000" invalidFileSizeMessageSummary="{0}: file kích cỡ quá lớn,"
                        invalidFileSizeMessageDetail="kích cỡ lớn nhất có thể lưu là {0}."
                        invalidFileTypeMessageSummary="{0}: định dạng file bị cấm, "
                        invalidFileTypeMessageDetail="bạn chỉ có thể lưu các file có định dạng như: {0}."
                        chooseLabel="Chọn file" cancelLabel="Hủy file đã chọn"
                        (onSelect)="handleFile($event, fileUpload)" (onRemove)="removeFile($event)"
                        (onClear)="clearAllFile()">
                        <ng-template pTemplate="content" let-files>
                          <div *ngIf="uploadedFiles.length == 0" style="padding-top: 30px; padding-bottom: 30px;">
                            <i class="fa fa-upload" aria-hidden="true" style="font-size: 36px;"></i>
                            <div style="margin-top: 5px;">Kéo thả file để
                              upload
                            </div>
                          </div>
                        </ng-template>
                      </p-fileUpload>
                    </div> -->

                        <div class="col-md-12" style="text-align: left; margin-top: 5px;">
                          <div class="col-md-6" style="text-align: left; margin-top: 5px;">
                            <div class="row buffer-bottom">
                              <p-checkbox name="groupname1" formControlName="isSendEmailControl" binary="true"
                                label="Không gửi thông báo qua email">
                              </p-checkbox>
                            </div>
                          </div>
                          <div class="col-md-6" style="text-align: right; margin-top: 5px;">
                            <button type="button" class="btn-cancel-note" (click)="cancelNote()">
                              <span class="save-cancel-lable">Hủy</span>
                            </button>
                            <button type="button" class="btn-save-note" (click)="saveNote()">
                              <span class="save-note-lable">{{isEditNote == true ? 'Cập nhật ghi chú':'Thêm ghi
                                chú'}}</span>
                            </button>
                          </div>
                        </div>
                      </div>
                    </p-accordionTab>
                  </p-accordion>
                  <p-accordion expandIcon="pi pi-fw pi-chevron-circle-right" class="col-md-12"
                    collapseIcon="pi pi-fw pi-chevron-circle-down">
                    <p-accordionTab header="Dòng thời gian" [selected]="true">
                      <div class="row">
                        <div class="timeline col-md-12 timeline-content">
                          <ul class="timeline">
                            <li *ngFor="let note of noteHistory;let noteIndex = index;">
                              <i *ngIf="note.type == 'ADD'" class="fa fa-file-text-o bg-blueX color-w"></i>
                              <i *ngIf="note.type == 'NOT'" class="fa fa-commenting-o bg-blueX color-w"></i>
                              <i *ngIf="note.type == 'EDT'" class="fa fa-user bg-blueX color-w"></i>
                              <i *ngIf="note.type == 'NEW'" class="fa fa-user-plus bg-blueX color-w"></i>

                              <div class="timeline-item" id="{{note.noteId}}">
                                <span class="time onHover">
                                  <i *ngIf="note.type !== 'SYS'  && ((note.description !== '' && note.description !== null) || note.noteDocList.length > 0) && actionEditNote"
                                    (click)="onClickEditNote(note.noteId, note.description)"
                                    class="pi pi-pencil style-edit"
                                    pTooltip="{{ 'lead.tooltip.edit_note' | translate }}" tooltipPosition="bottom"></i>
                                  <i *ngIf="actionEditNote && note.type !== 'SYS'" pTooltip="Xóa ghi chú"
                                    tooltipPosition="bottom" (click)="onClickDeleteNote(note.noteId)"
                                    class="pi pi-trash style-delete"></i>
                                </span>
                                <h3 class="timeline-header">
                                  <span>
                                    <i *ngIf="tooLong(note)"
                                      class="trigger_node collapse-content-icon pi pi-chevron-right"
                                      (click)="trigger_node(note.noteId,$event)" style="cursor: pointer;"
                                      pTooltip="{{ toggle_note_label }}" tooltipPosition="bottom"></i>
                                    <span class="alignment" style="padding: 0 12px;" *ngIf="!tooLong(note)"></span>
                                  </span>
                                  <div>
                                    <img *ngIf="note" [src]="defaultAvatar" height="30" width="30" alt=""
                                      class="timeline-user-avatar" />
                                  </div>
                                  <span class="note-user">{{note.responsibleName}}</span>
                                  <p class="time-note">
                                    {{note.noteTitle}} Lúc
                                    {{note.createdDate |
                                    date:'HH:mm'}}
                                    {{ 'lead.note.day' | translate }}
                                    {{note.createdDate | date:'dd/MM/yyyy'}}
                                  </p>

                                </h3>
                                <div class="timeline-body">
                                  <div class="note-content">
                                    <span class="short-content" style="word-wrap: break-word;"></span>
                                    <span class="full-content" style="display: none;word-wrap: break-word;"></span>
                                  </div>

                                  <div *ngIf="note.noteDocList.length > 0" class="row no-margin file-upload-zone"
                                    style="padding: 0 12px; margin-bottom: 20px !important">
                                    <div *ngFor="let item of note.noteDocList.slice(0,3); let i=index"
                                      class="col-md-4 short-content-file" style="padding: 5px 0">
                                      <div class="row no-margin file-item"
                                        style="background-color: rgb(228, 228, 228); padding: 5px 10px">
                                        <div class="col-md-1">
                                          <i class="pi pi-file" style="font-size: 1.55em;"></i>
                                        </div>
                                        <div class="col-md-10">
                                          <div class="item-name" pTooltip="{{ item.documentName }}"
                                            tooltipPosition="bottom">
                                            <span>
                                              <a class="preview-doc"
                                                (click)="openItem(item.documentName, item.documentUrl)">
                                                {{
                                                item.documentName
                                                }}
                                              </a>
                                            </span>
                                          </div>
                                          <div style="font-size: 10px; padding: 0 !important">
                                            {{
                                            (item.documentSize)/1024/1024
                                            |
                                            number:'.2' }}
                                            MB
                                          </div>
                                        </div>
                                        <div class="col-md-1">
                                          <i class="pi pi-download" (click)="downloadNoteFile(item)"
                                            style="font-size: 1.55em; cursor: pointer;"></i>
                                        </div>
                                      </div>
                                    </div>
                                    <div *ngFor="let item of note.noteDocList;let i=index"
                                      class="col-md-4 full-content-file" style="display: none;padding: 5px 0">
                                      <div class="row no-margin file-item"
                                        style="background-color: rgb(228, 228, 228); padding: 5px 10px">
                                        <div class="col-md-1">
                                          <i class="pi pi-file" style="font-size: 1.55em;"></i>
                                        </div>
                                        <div class="col-md-10">
                                          <div class="item-name" pTooltip="{{ item.documentName }}"
                                            tooltipPosition="bottom">
                                            <span>
                                              <a class="preview-doc" (click)="openItem(item.base64Url)">
                                                {{
                                                item.documentName
                                                }}
                                              </a>
                                            </span>
                                          </div>
                                          <div style="font-size: 10px; padding: 0 !important">
                                            {{
                                            item.documentSize/1024/1024
                                            |
                                            number:'.2'
                                            }} MB
                                          </div>
                                        </div>
                                        <div class="col-md-1">
                                          <i class="pi pi-file" (click)="downloadNoteFile(item)"
                                            style="font-size: 1.55em; cursor: pointer;"></i>
                                        </div>
                                      </div>
                                    </div>
                                    <p *ngIf="note.noteDocList.length > 3" class="col-md-12 continue">
                                      <b>...</b>
                                    </p>
                                  </div>
                                </div>
                              </div>
                            </li>
                          </ul>
                          <p-paginator #paginator [rows]="10" [totalRecords]="totalRecordsNote"
                            (onPageChange)="paginate($event)" [rowsPerPageOptions]="[10,20,30]">
                          </p-paginator>
                        </div>
                      </div>
                    </p-accordionTab>
                  </p-accordion>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
    <!-- Footer -->
    <main-footer></main-footer>
  </div>
</div>

<p-dialog header="Copy hạng mục dự án" [(visible)]="displayCopyScope" [modal]="true" [style]="{width: '60vw'}"
  class="copy-dialog" [draggable]="false" [resizable]="false">
  <form [formGroup]="cloneProjectScope" style="overflow: hidden;" class="confirm-dialog">
    <div class="row top-buffer bottom-buffer content-dialog">
      <div class="col-md-12 mb-20">
        <div class="col-md-6">
          Chọn dự án<span class="required">*</span>
        </div>
      </div>
      <div class="col-md-12 mb-20">
        <div class="col-md-6">
          <p-dropdown [options]="listProject" optionLabel="projectName" [autoDisplayFirst]="false" [filter]="true"
            [showClear]="true" [resetFilterOnHide]="true" (onChange)="changeProject($event)"
            formControlName="projectControl" placeholder="Chọn dự án" [style]="{'width': '100%'}">
          </p-dropdown>
        </div>
        <div class="col-md-6" style="display: flex; justify-content: flex-end">
          <button (click)="cancelCopy()" type="button" class="btn-remove-copy">
            <span class="btn-remove-text-copy">Đóng</span>
          </button>
          <button (click)="saveCopy()" type="button" class="btn-save-copy">
            <span class="btn-save-text-copy">Copy</span>
          </button>
        </div>
      </div>
      <!-- CÂY HẠNG MỤC -->
      <div class="organization-chart mt-20">
        <p-organizationChart [value]="dataCopy" selectionMode="single">
        </p-organizationChart>
      </div>
    </div>
  </form>
</p-dialog>